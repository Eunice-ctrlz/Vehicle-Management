{% extends 'base.html' %}
{% block content %}
<div class="container text-center mt-5">
    <div class="spinner-border text-primary" role="status"></div>
    <h2 class="mt-3">Processing Payment...</h2>
    <p>Please check your phone and enter your M-Pesa PIN.</p>
    <p class="text-muted">Do not refresh this page.</p>
</div>

<script>
    let checkStatus = setInterval(function() {
        fetch("/payments/check-status/{{ checkout_id }}/")
        .then(response => response.json())
        .then(data => {
            if (data.status === 'Completed') {
                clearInterval(checkStatus);
                window.location.href = "{% url 'my_bookings' %}";
            } else if (data.status === 'Failed') {
                clearInterval(checkStatus);
                alert("Payment failed or was cancelled.");
                window.location.href = "{% url 'home' %}";
            }
        });
    }, 3000); 
</script>
{% endblock %}