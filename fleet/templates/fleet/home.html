{% extends 'fleet/customer_base.html' %}

{% block extra_css %}
<style>
    .fleet-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .car-card { background: #111; border: 1px solid #222; border-radius: 10px; padding: 14px; }
    .car-card img { border-radius: 6px; }
    .car-card .price { color: #c5a059; font-weight: 700; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <h2 style="color: white;">Available Fleet</h2>
    <p style="color: #888;">Choose a vehicle to start your journey.</p>

    {% if cars %}
    <div class="fleet-grid mt-3">
        {% for car in cars %}
        <div class="car-card">
            {% if car.image %}
            <div style="height:160px; overflow:hidden; border-radius:8px; margin-bottom:10px; background:#000;">
                <img src="{{ car.image.url }}" alt="{{ car.name }}" style="width:100%; height:100%; object-fit:cover;">
            </div>
            {% endif %}

            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:700; color:#fff;">{{ car.name }}</div>
                    <div class="small" style="color:#888;">Plate: {{ car.plate_number }}</div>
                </div>
                <div class="price">Ksh {{ car.daily_rate }}</div>
            </div>

            <div style="margin-top:12px;">
                <a href="{% url 'bookings:create_booking' car.id %}" class="btn btn-outline-light w-100">Book Now</a>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <div style="padding: 40px; text-align: center; border: 1px dashed #444; color: #888;">
        No vehicles are currently available.
    </div>
    {% endif %}

    {% if cars.0 %}
    <div id="map" style="height: 300px; margin-top: 24px;"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([{{ cars.0.latitude }}, {{ cars.0.longitude }}], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        {% for car in cars %}
        L.marker([{{ car.latitude }}, {{ car.longitude }}]).addTo(map).bindPopup('{{ car.name }}');
        {% endfor %}
    </script>
    {% endif %}

</div>
{% endblock %}